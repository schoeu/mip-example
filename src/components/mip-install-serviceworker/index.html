<h1 id="mip-install-serviceworker">mip-install-serviceworker</h1><p><code>&lt;mip-install-serviceworker&gt;</code> 是实现离线可用的组件。</p>
<table>
<thead>
<tr>
<th>标题</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>通用</td>
</tr>
<tr>
<td>支持布局</td>
<td>N/S</td>
</tr>
<tr>
<td>所需脚本</td>
<td><a href="https://c.mipcdn.com/static/v1/mip-install-serviceworker/mip-install-serviceworker.js">https://c.mipcdn.com/static/v1/mip-install-serviceworker/mip-install-serviceworker.js</a></td>
</tr>
</tbody>
</table>
<h2 id="%E7%A4%BA%E4%BE%8B">示例</h2><h3 id="%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">基本用法</h3><pre><code>&lt;mip-install-serviceworker src=&quot;/sw.js&quot;
    data-iframe-src=&quot;https://mipexample.org/sw.html&quot;
    layout=&quot;nodisplay&quot;
    class=&quot;mip-hidden&quot;
    data-no-service-worker-fallback-url-match=&quot;.*\.html&quot;
    data-no-service-worker-fallback-shell-url=&quot;https://mipexample.org/shell/&quot;
&gt;&lt;/mip-install-serviceworker&gt;

&lt;a href=&quot;https://mipexample.org/some/path/index.html&quot;&gt;mip example link1&lt;/&gt;&lt;br/&gt;
&lt;a href=&quot;http://mipexample.org/some/path/index.html&quot;&gt;mip example link2&lt;/a&gt;&lt;br/&gt;
&lt;a href=&quot;https://another.mipexample.org/some/path/index.html&quot;&gt;mip example link3&lt;/&gt;
</code></pre><h2 id="%E5%B1%9E%E6%80%A7">属性</h2><h3 id="src">src</h3><p>说明：Service Worker 文件的路径，如果不在缓存路径下打开，会采用 <code>src</code> 注册 Service Worker<br>必选项：否<br>类型：字符串</p>
<h3 id="data-iframe-src">data-iframe-src</h3><p>说明：安装 Service Workder 的页面地址，在缓存下打开，由于不同域，无法直接注册，所以采用 <code>&lt;iframe&gt;</code><br>必选项：否<br>类型：字符串</p>
<h3 id="data-no-service-worker-fallback-url-match">data-no-service-worker-fallback-url-match</h3><p>说明：当当前环境不支持 Service Worker 的时候，可以通过制定一个特殊的同源 shell 页面，提前加载这个 shell 页面进行浏览器缓存，可以通过 <code>data-no-service-worker-fallback-url-match</code> 属性指定需要跳转到该 shell 页面的规则，该属性为正则表达式<br>必选项：否<br>类型：正则表达式</p>
<h3 id="data-no-service-worker-fallback-shell-url">data-no-service-worker-fallback-shell-url</h3><p>说明：指定的 shell 页面的 url, 需要和 mip 页面保持同源，当该 shell 页面加载完成之后，有必须通过 url hash 后的参数 redirect 到原页面的逻辑<br>必选项：否<br>类型：字符串</p>
<h2 id="%E5%B7%A5%E4%BD%9C%E6%9C%BA%E5%88%B6">工作机制</h2><p>在这个组件里，提供了 <code>src</code> 和 <code>data-iframe-src</code> 两个属性，如果要让 Service Worker 能顺利注册，里那个属性都需要填写，因为 MIP 页不仅在搜索环境下打开，还可以被直接访问。</p>
<p>如果是直接通过 MIP 页的地址访问，以为着 Service Worker 的域名和当前站点一致，可以直接注册，这个时候我们需要 <code>src</code> 属性，会直接进行注册，如下：</p>
<pre><code class="lang-javascript">navigator.serviceWorker.register(src)
</code></pre>
<p>但是，MIP 页不仅能直接访问，还能被百度搜索缓存在 CDN 上，如果通过百度搜索结果页打开，那么这个这个页面的域名就不是站点本身的域名，无法通过 <code>navigator.serviceWorker.register</code> 直接注册，在这里我们通过嵌入站点自身的 iframe 来解决域名不同的问题，通过 iframe 来注册 Service Worker，提前缓存站点资源，这个 iframe 的地址就是 <code>data-iframe-src</code> 属性， iframe 页面内容可以很简单，如下：</p>
<pre><code class="lang-html">&lt;script&gt;
if (navigator.serviceWorker) {
    navigator.serviceWorker.register(&#39;/sw.js&#39;);
}
&lt;/script&gt;
</code></pre>
