<h1 id="mip-experiment%20%E5%89%8D%E7%AB%AF%E6%8A%BD%E6%A0%B7%E5%AE%9E%E9%AA%8C">mip-experiment 前端抽样实验</h1><p><code>&lt;mip-experiment&gt;</code> 组件用于前端抽样实验。<br>可用于按钮，banner，广告等前端可控元素的改版实验，与 <code>&lt;mip-pix&gt;</code> 可配合使用。  </p>
<table>
<thead>
<tr>
<th>标题</th>
<th>内容</th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>通用</td>
</tr>
<tr>
<td>支持布局</td>
<td>nodisplay</td>
</tr>
<tr>
<td>所需脚本</td>
<td><a href="https://c.mipcdn.com/static/v1/mip-experiment/mip-experiment.js">https://c.mipcdn.com/static/v1/mip-experiment/mip-experiment.js</a></td>
</tr>
</tbody>
</table>
<h2 id="%E7%A4%BA%E4%BE%8B">示例</h2><h3 id="1.%20%E5%9F%BA%E6%9C%AC%E7%94%A8%E6%B3%95">1. 基本用法</h3><p>每次刷新会重新分组。</p>
<pre><code class="lang-html">&lt;style&gt;
button {
    background-color: aquamarine;
    color: black;
    display: block;
    margin:10px;
    padding:20px;
}
body[mip-x-button-color=yellow] .exp-btn1 {
    background-color: yellow;
}
body[mip-x-button-color=grey] .exp-btn1 {
    background-color: #888888;
}
body[mip-x-button-color=blue] .exp-btn1 {
    background-color: #3388ff;
}
&lt;/style&gt;
&lt;mip-experiment layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot;&gt;
    &lt;script type=&quot;application/json&quot; for=&quot;mip-experiment&quot;&gt;
        {
            &quot;button-color&quot;: {
                &quot;sticky&quot;: false,
                &quot;descri&quot;: &quot;1.设置按钮背景色,黄-灰-蓝-绿&quot;,
                &quot;variants&quot;: {
                    &quot;yellow&quot;: 30,
                    &quot;grey&quot;: 30,
                    &quot;blue&quot;: 30
                }
            }
        }
    &lt;/script&gt;
    &lt;p&gt;设置按钮背景色,黄(30%)-灰(30%)-蓝(30%)-绿(默认10%)&lt;/p&gt;
    &lt;p&gt;每次刷新重新分组&lt;/p&gt;
    &lt;button class=&quot;exp-btn1&quot;&gt;修改背景色&lt;/button&gt;
&lt;/mip-experiment&gt;
</code></pre>
<h3 id="2.%20%E5%9B%BA%E5%AE%9A%E5%88%86%E7%BB%84%E7%94%A8%E6%B3%95">2. 固定分组用法</h3><p>第一次实验抽样后，分组存储在 localStorage 中，再次刷新分组不变。</p>
<pre><code class="lang-html">&lt;style&gt;
button {
    background-color: aquamarine;
    color: black;
    display: block;
    margin:10px;
    padding:20px;
}
body[mip-x-button-color2=yellow] .exp-btn2 {
    background-color: yellow;
}
body[mip-x-button-color2=grey] .exp-btn2 {
    background-color: #888888;
}
body[mip-x-button-color2=blue] .exp-btn2 {
    background-color: #3388ff;
}
&lt;/style&gt;
&lt;mip-experiment layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot;&gt;
    &lt;script type=&quot;application/json&quot; for=&quot;mip-experiment&quot;&gt;
        {
            &quot;button-color2&quot;: {
                &quot;sticky&quot;: true,
                &quot;descri&quot;: &quot;2.设置按钮背景色,黄-灰-蓝-绿&quot;,
                &quot;variants&quot;: {
                    &quot;yellow&quot;: 30,
                    &quot;grey&quot;: 30,
                    &quot;blue&quot;: 30
                }
            }
        }
    &lt;/script&gt;
    &lt;p&gt;设置按钮背景色,黄(30%)-灰(30%)-蓝(30%)-绿(默认10%)&lt;/p&gt;
    &lt;p&gt;每次刷新【不】重新分组&lt;/p&gt;
    &lt;button class=&quot;exp-btn2&quot;&gt;修改背景色&lt;/button&gt;
&lt;/mip-experiment&gt;
</code></pre>
<h3 id="3.%20%E5%A4%9A%E7%BB%84%E6%8A%BD%E6%A0%B7">3. 多组抽样</h3><pre><code class="lang-html">&lt;style&gt;
button {
    background-color: aquamarine;
    color: black;
    display: block;
    margin:10px;
    padding:20px;
}
body[mip-x-button-color3=yellow] .exp-btn3 {
    background-color: yellow;
}
body[mip-x-button-color3=grey] .exp-btn3 {
    background-color: #888888;
}
body[mip-x-button-color3=blue] .exp-btn3 {
    background-color: #3388ff;
}
body[mip-x-font-color=black] .exp-btn3 {
    color: black;
}
body[mip-x-font-color=white] .exp-btn3 {
    color: white;
}
&lt;/style&gt;
&lt;mip-experiment layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot;&gt;
    &lt;script type=&quot;application/json&quot; for=&quot;mip-experiment&quot;&gt;
        {
            &quot;button-color3&quot;: {
                &quot;sticky&quot;: false,
                &quot;descri&quot;: &quot;3.设置按钮背景色,黄-灰-蓝-绿&quot;,
                &quot;variants&quot;: {
                    &quot;yellow&quot;: 30,
                    &quot;grey&quot;: 30,
                    &quot;blue&quot;: 30
                }
            },
            &quot;font-color&quot;: {
                &quot;sticky&quot;: false,
                &quot;descri&quot;: &quot;设置按钮字体颜色,黑-白&quot;,
                &quot;variants&quot;: {
                    &quot;black&quot;: 50,
                    &quot;white&quot;: 50
                }
            }
        }
    &lt;/script&gt;
    &lt;p&gt;设置按钮背景色,黄(30%)-灰(30%)-蓝(30%)-绿(默认10%)&lt;/p&gt;
    &lt;p&gt;设置按钮字体色,黑(50%)-白(50%)&lt;/p&gt;
    &lt;p&gt;每次刷新重新分组&lt;/p&gt;
    &lt;button class=&quot;exp-btn3&quot;&gt;修改背景色&amp;字体颜色&lt;/button&gt;
&lt;/mip-experiment&gt;
</code></pre>
<h3 id="4.%20%E8%B0%83%E8%AF%95%EF%BC%9A%E6%89%93%E5%8D%B0%E5%AE%9E%E9%AA%8C%E4%BF%A1%E6%81%AF">4. 调试：打印实验信息</h3><p>在 <code>&lt;mip-experiment&gt;</code> 上添加 <code>needConsole</code> 参数，可以在控制台看到分组过程和情况。</p>
<pre><code class="lang-html">&lt;style&gt;
button {
    background-color: aquamarine;
    color: black;
    display: block;
    margin:10px;
    padding:20px;
}
body[mip-x-button-color4=yellow] .exp-btn4 {
    background-color: yellow;
}
&lt;/style&gt;
&lt;mip-experiment layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot; needConsole&gt;
    &lt;script type=&quot;application/json&quot; for=&quot;mip-experiment&quot;&gt;
        {
            &quot;button-color4&quot;: {
                &quot;sticky&quot; : false,
                &quot;descri&quot;: &quot;4.设置按钮背景色,黄-绿&quot;,
                &quot;variants&quot;: {
                    &quot;yellow&quot;: 50
                }
            }
        }
    &lt;/script&gt;
    &lt;p&gt;设置按钮背景色,黄(50%)-绿(默认50%)&lt;/p&gt;
    &lt;p&gt;每次刷新重新分组&lt;/p&gt;
    &lt;p&gt;控制台显示分组过程信息&lt;/p&gt;
    &lt;button class=&quot;exp-btn4&quot;&gt;修改背景色&lt;/button&gt;
&lt;/mip-experiment&gt;
</code></pre>
<h3 id="5.%20%E8%B0%83%E8%AF%95%EF%BC%9AURL%20%E5%BC%BA%E5%88%B6%E4%B8%AD%E6%8A%BD%E6%A0%B7">5. 调试：URL 强制中抽样</h3><p>测试时，可通过给 URL 添加 hash 强制中抽样，如 <code>#mip-x-button-color5=red</code>。</p>
<pre><code class="lang-html">&lt;style&gt;
button {
    background-color: aquamarine;
    color: black;
    display: block;
    margin:10px;
    padding:20px;
}
body[mip-x-button-color5=yellow] .exp-btn5 {
    background-color: yellow;
}
body[mip-x-button-color5=red] .exp-btn5 {
    background-color: red;
}
&lt;/style&gt;
&lt;mip-experiment layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot; needConsole&gt;
    &lt;script type=&quot;application/json&quot; for=&quot;mip-experiment&quot;&gt;
        {
            &quot;button-color5&quot;: {
                &quot;sticky&quot; : false,
                &quot;descri&quot;: &quot;5.设置按钮背景色,黄-红-绿&quot;,
                &quot;variants&quot;: {
                    &quot;yellow&quot;: 50,
                    &quot;red&quot;: 1
                }
            }
        }
    &lt;/script&gt;
    &lt;p&gt;设置按钮背景色,黄(50%)-红(1%)-绿(默认49%)&lt;/p&gt;
    &lt;p&gt;在url中添加‘#mip-x-button-color5=red’显示红色按钮&lt;/p&gt;
    &lt;p&gt;控制台显示分组过程信息&lt;/p&gt;
    &lt;button class=&quot;exp-btn5&quot;&gt;修改背景色&lt;/button&gt;
&lt;/mip-experiment&gt;
</code></pre>
<h3 id="6.%20%E4%B8%8E%E7%99%BE%E5%BA%A6%E7%BB%9F%E8%AE%A1%E9%85%8D%E5%90%88%E4%BD%BF%E7%94%A8">6. 与百度统计配合使用</h3><p><code>&lt;mip-experiment&gt;</code>可以和<code>&lt;mip-stats-baidu&gt;</code>标签配合统计页面元素事件的触发次数。这个功能使用百度统计的<a href="http://tongji.baidu.com/open/api/more?p=guide_trackEvent">_trackEvent API</a>发送统计请求，在百度统计后台-访问分析-事件分析可以看到统计结果。</p>
<h4 id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9A">注意事项：</h4><ol>
<li>需要按照<code>&lt;mip-stats-baidu&gt;</code>文档引入百度统计代码和标签，请保证 <code>mip-stats-baidu.js</code> 在 <code>mip-experiment.js</code> 之前引入。</li>
<li>如果引入了多个百度统计，请以 <code>_hmt.id</code> 中的 <code>token</code> 为准，在 <code>token</code> 对应的统计后台查看数据。</li>
<li>开发时请关注控制台报错。</li>
<li>百度统计的数据产出有一定延迟，请在第二天查看数据。</li>
</ol>
<h4 id="%E7%BB%9F%E8%AE%A1%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E%EF%BC%9A">统计使用说明：</h4><ol>
<li>配置多个统计：<code>baidu-stats</code> 为统计配置的数组，里面每一个元素相当于一句 JS 的<code>addEventListener</code>。</li>
<li>配置统计参数：每个配置可以传入三个参数。<ol>
<li>第一个为元素选择器（支持 <code>element</code>, <code>id</code>, <code>class</code>）。</li>
<li>第二个为事件（<code>click</code>, <code>touchend</code>）。</li>
<li>第三个可以自定义（可以选择填写广告的单价或事件的权重）。</li>
</ol>
</li>
<li>统计结果：在站长平台看到的统计结果有三个参数:<ol>
<li>第一个对应元素加事件，相当于统计参数的 1 和 2，格式为 <code>element__click</code>。</li>
<li>第二个对应当前实验名和实验分组，格式为 <code>mip-x-name=group</code>。</li>
<li>第三个对应参数 3，自定义。</li>
</ol>
</li>
</ol>
<p>下面例子可用于实验 “改变按钮的背景色，计算按钮的点展比”。在 <code>baidu-stats</code> 中配置了页面加载的次数和按钮点击次数的统计。</p>
<pre><code class="lang-html">&lt;style&gt;
button {
    background-color: black;
    display: block;
    margin:10px;
    padding:20px;
}
body[mip-x-button-color=red] #btn01 {
    background-color: red;
}
body[mip-x-button-color=grey] #btn01 {
    background-color: #888888;
}
&lt;/style&gt;
&lt;mip-experiment layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot;&gt;
    &lt;script type=&quot;application/json&quot; for=&quot;mip-experiment&quot;&gt;
        {
            &quot;button-color6&quot;: {
                &quot;sticky&quot;: false,
                &quot;descri&quot;: &quot;设置按钮背景色,红-灰-黑（默认）&quot;,
                &quot;variants&quot;: {
                    &quot;red&quot;: 30,
                    &quot;grey&quot;: 30
                },
                &quot;baidu-stats&quot;: [
                    [&quot;window&quot;, &quot;load&quot;],
                    [&quot;#btn01&quot;, &quot;click&quot;，&quot;2.23&quot;]
                ]
            }
        }
    &lt;/script&gt;
    &lt;p&gt;设置按钮背景色,红（30%）-灰（30%）-黑（默认40%）&lt;/p&gt;
    &lt;p&gt;每次刷新重新分组&lt;/p&gt;
    &lt;button id=&quot;btn01&quot;&gt;修改背景色&lt;/button&gt;
&lt;/mip-experiment&gt;
&lt;script src=&quot;https://c.mipcdn.com/static/v1/mip-stats-baidu/mip-stats-baidu.js&quot;&gt;&lt;/script&gt;
</code></pre>
<p>最后数据的产生格式为：  </p>
<table>
<thead>
<tr>
<th>--</th>
<th>次数</th>
<th>参数A</th>
<th>参数B</th>
<th>参数C</th>
</tr>
</thead>
<tbody>
<tr>
<td>第1行</td>
<td>3083</td>
<td>window__load</td>
<td>mip-x-button-color6=red</td>
<td></td>
</tr>
<tr>
<td>第2行</td>
<td>3013</td>
<td>window__load</td>
<td>mip-x-button-color6=grey</td>
<td></td>
</tr>
<tr>
<td>第3行</td>
<td>4742</td>
<td>window__load</td>
<td>mip-x-button-color6=default</td>
<td></td>
</tr>
<tr>
<td>第4行</td>
<td>127</td>
<td>#btn01__click</td>
<td>mip-x-button-color6=red</td>
<td>2.23</td>
</tr>
<tr>
<td>第5行</td>
<td>210</td>
<td>#btn01__click</td>
<td>mip-x-button-color6=grey</td>
<td>2.23</td>
</tr>
<tr>
<td>第6行</td>
<td>272</td>
<td>#btn01__click</td>
<td>mip-x-button-color6=default</td>
<td>2.23</td>
</tr>
</tbody>
</table>
<ul>
<li>第 1 行和第 4 行为按钮红色情况，点展比为 127/3083 = 4.12%</li>
<li>第 2 行和第 5 行为按钮灰色情况，点展比为 210/3013 = 6.97%</li>
<li>第 3 行和第 6 行为按钮黑色情况(默认，对照组)，点展比为 272/4742 = 5.74%</li>
</ul>
<p>可见，红色按钮实验点展比降低，灰色按钮实验点展比升高。</p>
<h2 id="%E5%B1%9E%E6%80%A7">属性</h2><h3 id="layout%2C%20class">layout, class</h3><p>说明：组件布局，建议使用，避免实验初始化时页面抖动<br>必选项：否<br>类型：字符串<br>取值：<code>layout=&quot;nodisplay&quot; class=&quot;mip-hidden&quot;</code>  </p>
<h3 id="%E5%AE%9E%E9%AA%8C%E5%90%8D">实验名</h3><p>说明：示例中 <code>button-color</code> 处，注意和 CSS 中的 <code>mip-x-[button-color]</code> 对应<br>必选项：是<br>类型：字符串  </p>
<h3 id="descri">descri</h3><p>说明：实验描述，不参与实验分组计算<br>必选项：否<br>类型：字符串  </p>
<h3 id="variants">variants</h3><p>说明：实验分组配置。填写 key-value 组成的对象。key 对应 CSS 中的属性选择器，value 对应分组流量。如果 value 填写 30，则有 30% 的流量进入该分组<br>必选项：是<br>类型：JSON 对象  </p>
<h3 id="sticky">sticky</h3><p>说明：实验分组配置。填写 key-value 组成的对象。key 对应 CSS 中的属性选择器，value  对应分组流量。如果 value 填写 30，则有 30% 的流量进入该分组<br>必选项：否<br>类型：布尔值<br>默认值：true<br>取值：true, false  </p>
<h3 id="baidu-stats">baidu-stats</h3><p>说明：实验分组统计配置。具体配置方法，请参考本文【6. 与百度统计配合使用】
必选项：否<br>类型：数组  </p>
<h2 id="%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9">注意事项</h2><ol>
<li><code>&lt;application/json&gt;</code> 为实验分组配置，要求填写合法的JSON对象。开发时请注意控制台是否有报错。</li>
<li>如果使用百度统计，请保证 <code>mip-stats-baidu.js</code> 在 <code>mip-experiment.js</code> 之前引入。</li>
</ol>
